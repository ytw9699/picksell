<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="client_product">
	
	<select id="selectProductOne" resultType="hashmap" parameterType="hashmap">
		select * from ps_product a, ps_category b 
		where a.product_num = #{product_num} and a.category_num = b.category_num
	</select>
	
	<select id="selectNomalProductList" resultType="hashmap" parameterType="hashmap">
		<if test='category == "0" '>
			select * from ps_product 
			where howtosell != 2 
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
		</if>
		<if test='category != "0" '>
			select * from ps_product 
			where howtosell != 2 and category_num = #{category}
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
			
		</if>
	</select>
	
	<select id="selectPlusProductList" resultType="hashmap" parameterType="hashmap">
		<if test='category == "0" '>
			select * from ps_product 
			where howtosell = 2
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
		</if>
		<if test='category != "0" '>
			select * from ps_product 
			where howtosell = 2 and category_num = #{category}
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
			
		</if>
	</select>
	
	<select id="selectProductComment" resultType="hashmap" parameterType="int">
		select * from ps_pro_comment 
		where product_num = #{product_num}
		order by group_num desc, step_num asc
	</select>
	
	<select id="selectPurchaseList" resultType="hashmap" parameterType="int">
		select * from ps_purchase_list 
		where product_num = #{product_num}
		order by regdate desc
	</select>
	
	<insert id="insertProduct" parameterType="hashmap">
		insert into ps_product(product_num,
								category_num,
								seller_id,
								howtosell,
								hitcount,
								stock,
								product_regdate,
								deal_status,
								board_status,
								content,
								first_img,
								subject,
								product_status,
								price) values(product_seq.NEXTVAL,
												#{category_num},
												#{seller_id},
												#{howtosell},
												0,
												#{stock},
												sysdate,
												0,
												0,
												#{content},
												#{first_img},
												#{subject},
												#{product_status},
												#{price})
	</insert>
	
	<insert id="insertProductComment" parameterType="hashmap">
		insert into ps_pro_comment(comment_num,
									product_num,
									comment_writer,
									group_num,
									step_num,
									comment_regdate,
									comment_content) values(comment_seq.NEXTVAL,
															#{product_num},
															'임시작성자',
															comment_seq.CURRVAL,
															#{step_num},
															sysdate,
															#{comment_content})
	</insert>
	
	<insert id="insertPurchaseList" parameterType="hashmap">
		insert into ps_purchase_list(purchase_num,
										product_num,
										buyer_id,
										regdate,
										status) values(pl_seq.NEXTVAL,
														#{product_num},
														#{buyer_id},
														sysdate,
														0)
	</insert>
	
	<update id="updateProductHitcount" parameterType="hashmap">
		update ps_product set hitcount = hitcount + 1 where product_num = #{product_num}
	</update>
	
	<delete id="deletePurchaseList" parameterType="hashmap">
		delete from ps_purchase_list 
		where product_num = #{product_num} and buyer_id = #{buyer_id}
	</delete>
</mapper>