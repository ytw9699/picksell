<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="client_product">
	
	<select id="selectProductOne" resultType="hashmap" parameterType="hashmap">
		select * from ps_product a, ps_category b 
		where a.product_num = #{product_num} and a.category_num = b.category_num
	</select>
	
	<select id="selectProductListMain" resultType="hashmap" parameterType="hashmap">
			select * from(
			select b.seller_id, a.subject, count(b.orderlist_num) as sell, a.product_regdate, a.product_num ,
			a.category_num, a.howtosell, a.hitcount, a.stock, a.deal_status, a.board_status, 
			a.content, a.first_img, a.product_status, a.price from(
			select * from ps_product 
			<choose>
				<when test='ls == "0" '>
				where category_num = #{ca}) a left outer join ps_orderlist b on a.seller_id = b.seller_id 
				group by b.seller_id, a.subject, a.product_regdate, a.product_num, a.category_num, a.howtosell, a.hitcount, 
				a.stock, a.deal_status, a.board_status, a.content, a.first_img, a.product_status, a.price) c, ps_member d 
				where c.seller_id = d.id 
				</when>
				<when test='ls == "1" '>
				where howtosell = 2 and category_num = #{ca}) a left outer join ps_orderlist b on a.seller_id = b.seller_id 
				group by b.seller_id, a.subject, a.product_regdate, a.product_num, a.category_num, a.howtosell, a.hitcount, 
				a.stock, a.deal_status, a.board_status, a.content, a.first_img, a.product_status, a.price) c, ps_member d 
				where c.seller_id = d.id 
				</when>
				<when test='ls == "2" '>
				where howtosell != 2 and category_num = #{ca}) a left outer join ps_orderlist b on a.seller_id = b.seller_id 
				group by b.seller_id, a.subject, a.product_regdate, a.product_num, a.category_num, a.howtosell, a.hitcount, 
				a.stock, a.deal_status, a.board_status, a.content, a.first_img, a.product_status, a.price) c, ps_member d 
				where c.seller_id = d.id 
				</when>
			</choose> 
			<choose>
				<when test='od == "0" '>
				order by product_regdate desc
				</when>
				<when test='od == "1" '>
				order by price asc
				</when>
				<when test='od == "2" '>
				order by price desc
				</when>
			</choose>
	</select>
	
	<select id="selectNomalProductList" resultType="hashmap" parameterType="hashmap">
		<if test='category == "0" '>
			select * from(
			select b.seller_id, a.subject, count(b.orderlist_num) as sell, a.product_regdate, a.product_num ,
			a.category_num, a.howtosell, a.hitcount, a.stock, a.deal_status, a.board_status, 
			a.content, a.first_img, a.product_status, a.price from(
			select * from ps_product where howtosell != 2) a left outer join ps_orderlist b on a.seller_id = b.seller_id 
			group by b.seller_id, a.subject, a.product_regdate, a.product_num, a.category_num, a.howtosell, a.hitcount, 
			a.stock, a.deal_status, a.board_status, a.content, a.first_img, a.product_status, a.price) c, ps_member d 
			where c.seller_id = d.id 
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
		</if>
		<if test='category != "0" '>
			select * from(
			select b.seller_id, a.subject, count(b.orderlist_num) as sell, a.product_regdate, a.product_num ,
			a.category_num, a.howtosell, a.hitcount, a.stock, a.deal_status, a.board_status, 
			a.content, a.first_img, a.product_status, a.price from(
			select * from ps_product where howtosell != 2 and category_num = #{category}) a left outer join ps_orderlist b on a.seller_id = b.seller_id 
			group by b.seller_id, a.subject, a.product_regdate, a.product_num, a.category_num, a.howtosell, a.hitcount, 
			a.stock, a.deal_status, a.board_status, a.content, a.first_img, a.product_status, a.price) c, ps_member d 
			where c.seller_id = d.id 		
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
			
		</if>
	</select>
	
	<select id="selectPlusProductList" resultType="hashmap" parameterType="hashmap">
		<if test='category == "0" '>
			select * from(
			select b.seller_id, a.subject, count(b.orderlist_num) as sell, a.product_regdate, a.product_num ,
			a.category_num, a.howtosell, a.hitcount, a.stock, a.deal_status, a.board_status, 
			a.content, a.first_img, a.product_status, a.price from(
			select * from ps_product where howtosell = 2) a left outer join ps_orderlist b on a.seller_id = b.seller_id 
			group by b.seller_id, a.subject, a.product_regdate, a.product_num, a.category_num, a.howtosell, a.hitcount, 
			a.stock, a.deal_status, a.board_status, a.content, a.first_img, a.product_status, a.price) c, ps_member d 
			where c.seller_id = d.id 
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
		</if>
		<if test='category != "0" '>
			select * from(
			select b.seller_id, a.subject, count(b.orderlist_num) as sell, a.product_regdate, a.product_num ,
			a.category_num, a.howtosell, a.hitcount, a.stock, a.deal_status, a.board_status, 
			a.content, a.first_img, a.product_status, a.price from(
			select * from ps_product where howtosell = 2 and category_num = #{category}) a left outer join ps_orderlist b on a.seller_id = b.seller_id 
			group by b.seller_id, a.subject, a.product_regdate, a.product_num, a.category_num, a.howtosell, a.hitcount, 
			a.stock, a.deal_status, a.board_status, a.content, a.first_img, a.product_status, a.price) c, ps_member d 
			where c.seller_id = d.id 
			<choose>
				<when test='orderMethod == "0" '>
				order by product_regdate desc
				</when>
				<when test='orderMethod == "1" '>
				order by price asc
				</when>
				<when test='orderMethod == "2" '>
				order by price desc
				</when>
			</choose>
			
		</if>
	</select>
	
	<select id="selectProductComment" resultType="hashmap" parameterType="int">
		select * from ps_pro_comment 
		where product_num = #{product_num}
		order by group_num desc, step_num asc
	</select>
	
	<select id="selectPurchaseList" resultType="hashmap" parameterType="int">
		select * from ps_purchase_list 
		where product_num = #{product_num}
		order by regdate desc
	</select>
	
	<select id="selectSellerPurchaseList" resultType="hashmap" parameterType="int">
		select * from ps_purchase_list 
		where product_num = #{product_num} 
		order by regdate desc
	</select>
	
	<select id="selectAlradyPurchaseApproving" resultType="int" parameterType="int">
		select count(*) from ps_purchase_list 
		where product_num = #{product_num} and status = 1
	</select>
	
	<select id="selectMyPurchase2" resultType="int" parameterType="hashmap">
		select status from ps_purchase_list 
		where buyer_id = #{buyer_id} and product_num = #{product_num}
	</select>
	
	<select id="getCategoryList" resultType="hashmap">
		select * from ps_category
	</select>
	
	<insert id="insertProduct" parameterType="hashmap">
		insert into ps_product(product_num,
								category_num,
								seller_id,
								howtosell,
								hitcount,
								stock,
								product_regdate,
								deal_status,
								board_status,
								content,
								first_img,
								subject,
								product_status,
								price) values(product_seq.NEXTVAL,
												#{category_num},
												#{seller_id},
												#{howtosell},
												0,
												#{stock},
												sysdate,
												0,
												0,
												#{content},
												#{first_img},
												#{subject},
												#{product_status},
												#{price})
	</insert>
	
	<insert id="insertProductComment" parameterType="hashmap">
		insert into ps_pro_comment(comment_num,
									product_num,
									comment_writer,
									group_num,
									step_num,
									comment_regdate,
									comment_content) values(comment_seq.NEXTVAL,
															#{product_num},
															'임시작성자',
															comment_seq.CURRVAL,
															#{step_num},
															sysdate,
															#{comment_content})
	</insert>
	
	<insert id="insertPurchaseList" parameterType="hashmap">
		insert into ps_purchase_list(purchase_num,
										product_num,
										buyer_id,
										regdate,
										status) values(pl_seq.NEXTVAL,
														#{product_num},
														#{buyer_id},
														sysdate,
														0)
	</insert>
	
	<update id="updateProductHitcount" parameterType="hashmap">
		update ps_product set hitcount = hitcount + 1 where product_num = #{product_num}
	</update>
	
	<update id="letPurchaseApprove" parameterType="int">
		update ps_purchase_list set status = 1 
		where purchase_num = #{purchase_num}
	</update>
	
	<update id="letPurchaseApproveCancel" parameterType="int">
		update ps_purchase_list set status = 0 
		where purchase_num = #{purchase_num}
	</update>
	
	<delete id="deletePurchaseList" parameterType="hashmap">
		delete from ps_purchase_list 
		where product_num = #{product_num} and buyer_id = #{buyer_id}
	</delete>
	
	<!-- 알람읽기 -->
<update id="alarmRead" parameterType="int">
		update PS_ALARM set ALARM_CHECK = 'YES' where ALARM_NUM = #{ALARM_NUM}
</update>
<!-- 최근본상품 로직 by태원 -->
<insert id="insertRecentProduct" parameterType="hashmap">
		insert into PS_RECENT_PRODUCT(RECENT_NUM,
								RECENT_PRODUCT_NUM,
								RECENT_CATEGORY_NUM,
								RECENT_REGDATE,
								RECENT_ID) values(RECENT_PRODUCT_SEQ.NEXTVAL,
												#{product_num},
												#{category_num},
												sysdate,
												#{currentID}
												)
</insert>
<!-- 최근본상품 로직 by태원 -->
</mapper>